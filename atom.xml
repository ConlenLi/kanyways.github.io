<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>懒人屋</title>
  
  <subtitle>思想和境界一直在倒退的小虫</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="//kany.me/"/>
  <updated>2019-09-17T07:37:18.532Z</updated>
  <id>//kany.me/</id>
  
  <author>
    <name>Kany.Wang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>about_old_blog</title>
    <link href="//kany.me/2019/09/17/about-old-blog/"/>
    <id>//kany.me/2019/09/17/about-old-blog/</id>
    <published>2019-09-17T07:34:00.000Z</published>
    <updated>2019-09-17T07:37:18.532Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><blockquote><p>虽然也没有多少人关注咱的这个网站，但是本着既然有这个站点就要做好的原则。<br>还是让大家知道下旧网站在什么地方，最要是博主很穷。所以使用了<strong>github pages</strong></p></blockquote><h2 id="访问地址"><a href="#访问地址" class="headerlink" title="访问地址"></a>访问地址</h2><blockquote><p>友情链接中的<a href="https://blog.kany.me" target="_blank" rel="noopener">旧博客</a>就是之前的博客地址</p></blockquote><p><strong><a href="https://blog.kany.me" target="_blank" rel="noopener">https://blog.kany.me</a></strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;虽然也没有多少人关注咱的这个网站，但是本着既然有这个站点就要做好的原则。&lt;br&gt;还是让大家知道下旧网站在什么地方，
      
    
    </summary>
    
    
    
      <category term="旧博客" scheme="//kany.me/tags/%E6%97%A7%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>Docker Compose 部署Nginx、Mariadb、Nacos-Server</title>
    <link href="//kany.me/2019/09/12/docker-compose-install-nginx-mariadb-nacos-server/"/>
    <id>//kany.me/2019/09/12/docker-compose-install-nginx-mariadb-nacos-server/</id>
    <published>2019-09-12T07:55:10.000Z</published>
    <updated>2019-09-12T07:58:54.779Z</updated>
    
    <content type="html"><![CDATA[<h2 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h2><ul><li>OS：Ubuntu Server 16.04.1 LTS 64位</li><li>Docker：19.03.1</li><li>Docker Compose：1.24.1</li></ul><h2 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h2><blockquote><p>在前面的文章中我们使用<strong>Dockerfile</strong>编写了文件，如果物理机重启之后每次我们都要手动处理关联项目，比较麻烦。<br>Docker Compose使用的是<strong>docker-compose.yml</strong>文件来配置的。所以我们来编写配置文件。</p></blockquote><a id="more"></a><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># 版本</span><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span><span class="token comment" spellcheck="true"># 服务配置</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># Nginx配置</span>  <span class="token key atrule">nginx-server</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 镜像名称</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest    <span class="token comment" spellcheck="true"># 容器名称</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>server    <span class="token comment" spellcheck="true"># 是否开机启动</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token comment" spellcheck="true"># 文件夹映射</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /data/nginx/conf/nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf<span class="token punctuation">:</span>ro <span class="token comment" spellcheck="true"># ro表示只读，read only</span>      <span class="token punctuation">-</span> /data/nginx/logs<span class="token punctuation">:</span>/var/log/nginx      <span class="token punctuation">-</span> /data/nginx/sites<span class="token punctuation">:</span>/etc/nginx/conf.d<span class="token punctuation">:</span>ro      <span class="token punctuation">-</span> /data/nginx/ssl<span class="token punctuation">:</span>/etc/nginx/ssl<span class="token punctuation">:</span>ro      <span class="token punctuation">-</span> /data/nginx/html<span class="token punctuation">:</span>/usr/share/nginx/html<span class="token punctuation">:</span>ro    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"80:80"</span>      <span class="token punctuation">-</span> <span class="token string">"443:443"</span>    <span class="token comment" spellcheck="true"># 定义网络</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># 加入的网络的名称</span>      <span class="token key atrule">app</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># ipv4的ip地址</span>        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.18.0.2  <span class="token comment" spellcheck="true"># 数据库配置</span>  <span class="token key atrule">mariadb-server</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 镜像名称</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mariadb<span class="token punctuation">:</span>latest    <span class="token comment" spellcheck="true"># 容器名称</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mariadb<span class="token punctuation">-</span>server    <span class="token comment" spellcheck="true"># 是否开机启动</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token comment" spellcheck="true"># 环境变量</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># 配置数据库密码</span>      <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD<span class="token punctuation">:</span>数据库密码    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /data/mariadb/conf<span class="token punctuation">:</span>/etc/mysql/conf.d<span class="token punctuation">:</span>ro      <span class="token punctuation">-</span> /data/mariadb/logs<span class="token punctuation">:</span>/var/log/mysql      <span class="token punctuation">-</span> /data/mariadb/data<span class="token punctuation">:</span>/var/lib/mysql    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"3306:3306"</span>    <span class="token comment" spellcheck="true"># 指定启动顺序</span>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> nginx<span class="token punctuation">-</span>server    <span class="token comment" spellcheck="true"># 定义网络</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># 加入的网络的名称</span>      <span class="token key atrule">app</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># ipv4的ip地址</span>        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.18.0.3  <span class="token comment" spellcheck="true"># nacos-master</span>  <span class="token key atrule">nacos-mater</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span>1.1.3    <span class="token comment" spellcheck="true"># 容器名称</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>mater    <span class="token comment" spellcheck="true"># 是否开机启动</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token comment" spellcheck="true"># 配置环境变量文件</span>    <span class="token key atrule">env_file</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./env/nacos<span class="token punctuation">-</span>ip.env    <span class="token comment" spellcheck="true"># 映射数据卷</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /data/nacos/cluster1/conf/cluster.conf<span class="token punctuation">:</span>/usr/local/nacos/conf/cluster.conf      <span class="token punctuation">-</span> /data/nacos/cluster1/conf/application.properties<span class="token punctuation">:</span>/usr/local/nacos/conf/application.properties<span class="token punctuation">:</span>ro      <span class="token punctuation">-</span> /data/nacos/cluster1/logs<span class="token punctuation">:</span>/usr/local/nacos/logs      <span class="token punctuation">-</span> /data/nacos/cluster1/data<span class="token punctuation">:</span>/usr/local/nacos/data    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"8848:8848"</span>      <span class="token punctuation">-</span> <span class="token string">"9555:9555"</span>    <span class="token comment" spellcheck="true"># 指定启动顺序</span>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mariadb<span class="token punctuation">-</span>server    <span class="token comment" spellcheck="true"># 定义网络</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># 加入的网络的名称</span>      <span class="token key atrule">app</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># ipv4的ip地址</span>        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.18.0.4  <span class="token comment" spellcheck="true"># nacos-slave</span>  <span class="token key atrule">nacos-slave</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span>1.1.3    <span class="token comment" spellcheck="true"># 容器名称</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>slave    <span class="token comment" spellcheck="true"># 是否开机启动</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token comment" spellcheck="true"># 配置环境变量文件</span>    <span class="token key atrule">env_file</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./env/nacos<span class="token punctuation">-</span>ip.env    <span class="token comment" spellcheck="true"># 映射数据卷</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /data/nacos/cluster2/conf/cluster.conf<span class="token punctuation">:</span>/usr/local/nacos/conf/cluster.conf      <span class="token punctuation">-</span> /data/nacos/cluster2/conf/application.properties<span class="token punctuation">:</span>/usr/local/nacos/conf/application.properties<span class="token punctuation">:</span>ro      <span class="token punctuation">-</span> /data/nacos/cluster2/logs<span class="token punctuation">:</span>/usr/local/nacos/logs      <span class="token punctuation">-</span> /data/nacos/cluster2/data<span class="token punctuation">:</span>/usr/local/nacos/data    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"8849:8848"</span>    <span class="token comment" spellcheck="true"># 指定启动顺序</span>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> mariadb<span class="token punctuation">-</span>server    <span class="token comment" spellcheck="true"># 定义网络</span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># 加入的网络的名称</span>      <span class="token key atrule">app</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># ipv4的ip地址</span>        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.18.0.5<span class="token comment" spellcheck="true">#定义网络组</span><span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 网络组名称</span>  <span class="token key atrule">app</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 网络的模式</span>    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge    <span class="token comment" spellcheck="true"># 配置网络</span>    <span class="token key atrule">ipam</span><span class="token punctuation">:</span>      <span class="token key atrule">driver</span><span class="token punctuation">:</span> default      <span class="token key atrule">config</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">## ip地址网络 这里宿主机一般会是该网段的 172.17.0.1,所以不要设置自网段为1</span>        <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> 172.18.0.0/24<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>上面用到的<strong>nacos-ip.env</strong>文件内容如下：</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash">NACOS_SERVERS<span class="token operator">=</span>172.18.0.4:8848 172.18.0.5:8848MYSQL_MASTER_SERVICE_HOST<span class="token operator">=</span>172.18.0.3MYSQL_MASTER_SERVICE_PORT<span class="token operator">=</span>3306MYSQL_MASTER_SERVICE_DB_NAME<span class="token operator">=</span>nacos_configMYSQL_MASTER_SERVICE_USER<span class="token operator">=</span>rootMYSQL_MASTER_SERVICE_PASSWORD<span class="token operator">=</span>数据库密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>查看docker的网络使用如下命令：</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 查看目前已有的网络</span>docker network <span class="token function">ls</span><span class="token comment" spellcheck="true"># 查看目前的网络</span>docker network inspect <span class="token operator">&lt;</span>Network Id<span class="token operator">></span><span class="token comment" spellcheck="true"># 删除目前的网络</span>docker network <span class="token function">rm</span> <span class="token operator">&lt;</span>Network Id<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="参考数据"><a href="#参考数据" class="headerlink" title="参考数据"></a>参考数据</h2><ul><li><a href="https://blog.csdn.net/qq_28478281/article/details/84105079" target="_blank" rel="noopener">docker-compose 结合nginx实现跨容器转发</a></li><li><a href="https://blog.csdn.net/Kiloveyousmile/article/details/79830810" target="_blank" rel="noopener">docker-compose网络设置之networks</a></li><li><a href="https://blog.csdn.net/qq_36148847/article/details/79427878" target="_blank" rel="noopener">docker-compose.yml 配置文件编写详解</a></li><li><a href="https://blog.csdn.net/lobber1987/article/details/79045494" target="_blank" rel="noopener">Docker network命令</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;软件环境&quot;&gt;&lt;a href=&quot;#软件环境&quot; class=&quot;headerlink&quot; title=&quot;软件环境&quot;&gt;&lt;/a&gt;软件环境&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;OS：Ubuntu Server 16.04.1 LTS 64位&lt;/li&gt;
&lt;li&gt;Docker：19.03.1&lt;/li&gt;
&lt;li&gt;Docker Compose：1.24.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;编写配置文件&quot;&gt;&lt;a href=&quot;#编写配置文件&quot; class=&quot;headerlink&quot; title=&quot;编写配置文件&quot;&gt;&lt;/a&gt;编写配置文件&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;在前面的文章中我们使用&lt;strong&gt;Dockerfile&lt;/strong&gt;编写了文件，如果物理机重启之后每次我们都要手动处理关联项目，比较麻烦。&lt;br&gt;Docker Compose使用的是&lt;strong&gt;docker-compose.yml&lt;/strong&gt;文件来配置的。所以我们来编写配置文件。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="docker" scheme="//kany.me/tags/docker/"/>
    
      <category term="docker-compose" scheme="//kany.me/tags/docker-compose/"/>
    
      <category term="dockerfile" scheme="//kany.me/tags/dockerfile/"/>
    
      <category term="database" scheme="//kany.me/tags/database/"/>
    
      <category term="mariadb" scheme="//kany.me/tags/mariadb/"/>
    
      <category term="mysql" scheme="//kany.me/tags/mysql/"/>
    
      <category term="nginx" scheme="//kany.me/tags/nginx/"/>
    
      <category term="nacos" scheme="//kany.me/tags/nacos/"/>
    
      <category term="nacos-server" scheme="//kany.me/tags/nacos-server/"/>
    
  </entry>
  
  <entry>
    <title>安装 Docker Compose</title>
    <link href="//kany.me/2019/09/12/docker-compose-install/"/>
    <id>//kany.me/2019/09/12/docker-compose-install/</id>
    <published>2019-09-12T07:51:11.000Z</published>
    <updated>2019-09-12T07:53:58.795Z</updated>
    
    <content type="html"><![CDATA[<h2 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h2><ul><li>OS：Ubuntu Server 16.04.1 LTS 64位</li><li>Docker：19.03.1</li></ul><h2 id="使用原因"><a href="#使用原因" class="headerlink" title="使用原因"></a>使用原因</h2><blockquote><p>Dockerfile创建的容器有如下缺点：</p><ul><li>不能开机随系统启动</li><li>启动顺序未知</li></ul><p>所以我们需要使用到Docker容器的进阶 Docker Compose</p></blockquote><a id="more"></a><h2 id="安装Doker-Compose"><a href="#安装Doker-Compose" class="headerlink" title="安装Doker Compose"></a>安装Doker Compose</h2><blockquote><p>文件地址：<a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">https://github.com/docker/compose/releases</a></p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> curl -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> -o /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>网络好的同学可以使用这个命令来获取，如果不好的情况下建议直接下载好之后传上去。</p></blockquote><p>将文件放置到<strong>/usr/local/bin/</strong>文件夹下，并添加执行权限：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://github.com/docker/compose/" target="_blank" rel="noopener">Docker Compose GitHub</a></li><li><a href="https://www.cnblogs.com/nieqibest/p/9846655.html" target="_blank" rel="noopener">centos7 安装 docker 和 docker compose</a></li><li><a href="https://blog.csdn.net/now19930616/article/details/85235016" target="_blank" rel="noopener">docker-compose 安装</a></li><li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">Docker Compose Docs</a>*****</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;软件环境&quot;&gt;&lt;a href=&quot;#软件环境&quot; class=&quot;headerlink&quot; title=&quot;软件环境&quot;&gt;&lt;/a&gt;软件环境&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;OS：Ubuntu Server 16.04.1 LTS 64位&lt;/li&gt;
&lt;li&gt;Docker：19.03.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;使用原因&quot;&gt;&lt;a href=&quot;#使用原因&quot; class=&quot;headerlink&quot; title=&quot;使用原因&quot;&gt;&lt;/a&gt;使用原因&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Dockerfile创建的容器有如下缺点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不能开机随系统启动&lt;/li&gt;
&lt;li&gt;启动顺序未知&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所以我们需要使用到Docker容器的进阶 Docker Compose&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="docker" scheme="//kany.me/tags/docker/"/>
    
      <category term="docker-compose" scheme="//kany.me/tags/docker-compose/"/>
    
      <category term="dockerfile" scheme="//kany.me/tags/dockerfile/"/>
    
  </entry>
  
  <entry>
    <title>Docker 安装 Nacos Server</title>
    <link href="//kany.me/2019/09/12/docker-install-nacos-server/"/>
    <id>//kany.me/2019/09/12/docker-install-nacos-server/</id>
    <published>2019-09-12T07:46:36.000Z</published>
    <updated>2019-09-12T09:23:12.645Z</updated>
    
    <content type="html"><![CDATA[<h2 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h2><blockquote><ul><li>OS：Ubuntu Server 16.04.1 LTS 64位</li><li>Docker：19.03.1</li><li>Nacos Server：1.1.3<ul><li>nacos-sever-01：172.17.0.7 </li><li>nacos-sever-02：172.17.0.8</li></ul></li><li>文件目录：<ul><li>/data/nacos/{cluster1,cluster2}/{data,conf,logs}</li></ul></li></ul></blockquote><h2 id="学习目的"><a href="#学习目的" class="headerlink" title="学习目的"></a>学习目的</h2><blockquote><p>学会自己构建<strong>Nacos Server</strong>，不依赖官方的<strong>nacos/nacos-server:last</strong>镜像。<br>参考了很多别人构建的镜像<a href="https://hub.docker.com/search?q=nacos&type=image" target="_blank" rel="noopener">https://hub.docker.com/search?q=nacos&amp;type=image</a>，发现别人写的都很简单。但是自己的始终不能像其他人一样简单的运行起来。<br>比如下面的例子：</p></blockquote><a id="more"></a><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">FROM zhegeshijiehuiyouai/java:1.8ENV MODE="standalone"ADD nacos-server-1.1.3.tar.gz /usr/local/ADD cluster.conf /usr/local/nacos/conf/ADD entrypoint.sh /EXPOSE 8848ENTRYPOINT ["/entrypoint.sh"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>完整地址：<a href="https://github.com/zhegeshijiehuiyouai/RoadToDevOps/blob/master/03-Dockerfile/01-nacos" target="_blank" rel="noopener">https://github.com/zhegeshijiehuiyouai/RoadToDevOps/blob/master/03-Dockerfile/01-nacos</a><br>反正我是怎么都没有运行起来。<br>但是使用v1.0.0的<strong>startup.sh</strong>运行v1.1.3的<strong>nacos-server.jar</strong>，采用standalone方式是可以运行起来的，使用集群就不成。<br>进入到镜像里面，再调用<strong>startup.sh</strong>集群是可以起来的。<br>所以这个到底是什么原因呢？就因为这个东西折腾已经三天。对此不想多说什么。<br>截至发文，还有集群列表不能正常显示的问题。目前也不知道能不能注册，待测试。</p></blockquote><h2 id="构建Nacos需要JDK镜像"><a href="#构建Nacos需要JDK镜像" class="headerlink" title="构建Nacos需要JDK镜像"></a>构建Nacos需要JDK镜像</h2><p><strong>Dockerfile文件内容：</strong></p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile"># 一定要使用FROM开头FROM openjdk:8u191-jre-alpine# 作者信息LABEL author="Jason.Wang"LABEL version="8u191"# 执行的命令RUN apk update; \    apk add --no-cache; \    apk --no-cache add tzdata; \    ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime; \    echo "Asia/Shanghai" > /etc/timezone;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>创建好之后执行<code>docker build . --tag jdk:8u191</code>这样就会创建一个JDK的镜像文件</p><h2 id="构建Nacos"><a href="#构建Nacos" class="headerlink" title="构建Nacos"></a>构建Nacos</h2><p><strong>Dockerfile文件内容：</strong></p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">FROM jdk:8u191MAINTAINER "kzone.wang@gmail.com"LABEL author="Jason.Wang"LABEL version="1.1.3"# set environmentENV MODE="cluster" \    PREFER_HOST_MODE="ip" \    BASE_DIR="/usr/local/nacos" \    CLASSPATH=".:/usr/local/nacos/conf:$CLASSPATH" \    NACOS_SERVERS="172.17.0.3:8848" \    CLUSTER_CONF="/usr/local/nacos/conf/cluster.conf" \    FUNCTION_MODE="all" \    JAVA_HOME="/usr/lib/jvm/java-1.8-openjdk/jre" \    NACOS_USER="nacos" \    JAVA="/usr/lib/jvm/java-1.8-openjdk/jre/bin/java" \    JVM_XMS="2g" \    JVM_XMX="2g" \    JVM_XMN="1g" \    JVM_MS="128m" \    JVM_MMS="320m" \    NACOS_DEBUG="n" \    TOMCAT_ACCESSLOG_ENABLED="false"ARG NACOS_VERSION=1.1.3WORKDIR /$BASE_DIRRUN  cd /usr/local; \    wget && wget https://github.com/alibaba/nacos/releases/download/${NACOS_VERSION}/nacos-server-${NACOS_VERSION}.tar.gz -P; \    tar -zxf nacos-server-${NACOS_VERSION}.tar.gz; \    rm -rf nacos-server-${NACOS_VERSION}.tar.gz;ADD docker-startup.sh bin/docker-startup.sh# Set startup log dirRUN mkdir -p logs \        && cd logs \        && touch start.out \        && ln -sf /dev/stdout start.out \        && ln -sf /dev/stderr start.outRUN chmod +x bin/docker-startup.shEXPOSE 8848ENTRYPOINT ["bin/docker-startup.sh"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用CentOS直接构建"><a href="#使用CentOS直接构建" class="headerlink" title="使用CentOS直接构建"></a>使用CentOS直接构建</h2><p><strong>Dockerfile文件内容：</strong></p><pre class="line-numbers language-dockerfile"><code class="language-dockerfile">FROM centos:7.5.1804MAINTAINER "kzone.wang@gmail.com"LABEL author="Jason.Wang"LABEL version="1.1.3"# set environmentENV MODE="cluster" \    PREFER_HOST_MODE="ip"\    BASE_DIR="/usr/local/nacos" \    CLASSPATH=".:/usr/local/nacos/conf:$CLASSPATH" \    CLUSTER_CONF="/usr/local/nacos/conf/cluster.conf" \    FUNCTION_MODE="all" \    JAVA_HOME="/usr/lib/jvm/java-1.8.0-openjdk" \    NACOS_USER="nacos" \    JAVA="/usr/lib/jvm/java-1.8.0-openjdk/bin/java" \    JVM_XMS="2g" \    JVM_XMX="2g" \    JVM_XMN="1g" \    JVM_MS="128m" \    JVM_MMS="320m" \    NACOS_DEBUG="n" \    TOMCAT_ACCESSLOG_ENABLED="false" \    TIME_ZONE="Asia/Shanghai"ARG NACOS_VERSION=1.1.3WORKDIR /$BASE_DIRRUN set -x \    && yum update -y \    && yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel wget iputils nc  vim libcurl\    && wget https://github.com/alibaba/nacos/releases/download/${NACOS_VERSION}/nacos-server-${NACOS_VERSION}.tar.gz -P /usr/local \    && tar -xzvf /usr/local/nacos-server-${NACOS_VERSION}.tar.gz -C /usr/local \    && rm -rf /usr/local/nacos-server-${NACOS_VERSION}.tar.gz /usr/local/nacos/bin/* /usr/local/nacos/conf/*.properties /usr/local/nacos/conf/*.example /usr/local/nacos/conf/nacos-mysql.sql \    && yum autoremove -y wget \    && ln -snf /usr/share/zoneinfo/$TIME_ZONE /etc/localtime && echo '$TIME_ZONE' > /etc/timezone \    && yum clean allADD docker-startup.sh bin/docker-startup.sh# Set startup log dirRUN mkdir -p logs \    && cd logs \    && touch start.out \    && ln -sf /dev/stdout start.out \    && ln -sf /dev/stderr start.outRUN chmod +x bin/docker-startup.shEXPOSE 8848ENTRYPOINT ["bin/docker-startup.sh"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Nacos-Server启动脚本"><a href="#Nacos-Server启动脚本" class="headerlink" title="Nacos Server启动脚本"></a>Nacos Server启动脚本</h2><blockquote><p>这个脚本是阿里巴巴nacos编写的，但是我进行了修改，<strong>我使用的jdk:8u191没有/bin/bash，只有/bin/sh</strong>这里进行了修改，其他的不知道了。</p></blockquote><p><strong>docker-startup.sh文件内容：</strong></p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span><span class="token comment" spellcheck="true"># Copyright 1999-2018 Alibaba Group Holding Ltd.</span><span class="token comment" spellcheck="true"># Licensed under the Apache License, Version 2.0 (the "License");</span><span class="token comment" spellcheck="true"># you may not use this file except in compliance with the License.</span><span class="token comment" spellcheck="true"># You may obtain a copy of the License at</span><span class="token comment" spellcheck="true">#      http://www.apache.org/licenses/LICENSE-2.0</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># Unless required by applicable law or agreed to in writing, software</span><span class="token comment" spellcheck="true"># distributed under the License is distributed on an "AS IS" BASIS,</span><span class="token comment" spellcheck="true"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><span class="token comment" spellcheck="true"># See the License for the specific language governing permissions and</span><span class="token comment" spellcheck="true"># limitations under the License.</span><span class="token keyword">set</span> -x<span class="token function">export</span> DEFAULT_SEARCH_LOCATIONS<span class="token operator">=</span><span class="token string">"classpath:/,classpath:/config/,file:./,file:./config/"</span><span class="token function">export</span> CUSTOM_SEARCH_LOCATIONS<span class="token operator">=</span><span class="token variable">${DEFAULT_SEARCH_LOCATIONS}</span>,file:<span class="token variable">${BASE_DIR}</span>/conf/,<span class="token variable">${BASE_DIR}</span>/init.d/<span class="token function">export</span> CUSTOM_SEARCH_NAMES<span class="token operator">=</span><span class="token string">"application,custom"</span>PLUGINS_DIR<span class="token operator">=</span><span class="token string">"/home/nacos/plugins/peer-finder"</span><span class="token keyword">function</span> print_servers<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">${PLUGINS_DIR}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token keyword">echo</span> <span class="token string">"#it is ip"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$CLUSTER_CONF</span>"</span>    <span class="token keyword">for</span> server <span class="token keyword">in</span> <span class="token variable">${NACOS_SERVERS}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>            <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$server</span>"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$CLUSTER_CONF</span>"</span>    <span class="token keyword">done</span>   <span class="token keyword">else</span>    sh <span class="token variable">$PLUGINS_DIR</span>/plugin.sh   <span class="token function">sleep</span> 30        <span class="token keyword">fi</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">#===========================================================================================</span><span class="token comment" spellcheck="true"># JVM Configuration</span><span class="token comment" spellcheck="true">#===========================================================================================</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">${MODE}</span>"</span> <span class="token operator">==</span> <span class="token string">"standalone"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Xms512m -Xmx512m -Xmn256m"</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.standalone=true"</span><span class="token keyword">else</span>  <span class="token comment" spellcheck="true">#JAVA_OPT="${JAVA_OPT} -server -Xms${JVM_XMS} -Xmx${JVM_XMX} -Xmn${JVM_XMN} -XX:MetaspaceSize=${JVM_MS} -XX:MaxMetaspaceSize=${JVM_MMS}"</span>  JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -server"</span>  <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">${NACOS_DEBUG}</span>"</span> <span class="token operator">==</span> <span class="token string">"y"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Xdebug -Xrunjdwp:transport=dt_socket,address=9555,server=y,suspend=n"</span>  <span class="token keyword">fi</span>  JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="token variable">${BASE_DIR}</span>/logs/java_heapdump.hprof"</span>  JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -XX:-UseLargePages"</span>  print_servers<span class="token keyword">fi</span><span class="token comment" spellcheck="true">#===========================================================================================</span><span class="token comment" spellcheck="true"># Setting system properties</span><span class="token comment" spellcheck="true">#===========================================================================================</span><span class="token comment" spellcheck="true"># set  mode that Nacos Server function of split</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">${FUNCTION_MODE}</span>"</span> <span class="token operator">==</span> <span class="token string">"config"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.functionMode=config"</span><span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">${FUNCTION_MODE}</span>"</span> <span class="token operator">==</span> <span class="token string">"naming"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.functionMode=naming"</span><span class="token keyword">fi</span><span class="token comment" spellcheck="true"># set nacos server ip</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token string">"<span class="token variable">${NACOS_SERVER_IP}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.server.ip=<span class="token variable">${NACOS_SERVER_IP}</span>"</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token string">"<span class="token variable">${USE_ONLY_SITE_INTERFACES}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.inetutils.use-only-site-local-interfaces=<span class="token variable">${USE_ONLY_SITE_INTERFACES}</span>"</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token string">"<span class="token variable">${PREFERRED_NETWORKS}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.inetutils.preferred-networks=<span class="token variable">${PREFERRED_NETWORKS}</span>"</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -z <span class="token string">"<span class="token variable">${IGNORED_INTERFACES}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.inetutils.ignored-interfaces=<span class="token variable">${IGNORED_INTERFACES}</span>"</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">${PREFER_HOST_MODE}</span>"</span> <span class="token operator">==</span> <span class="token string">"hostname"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.preferHostnameOverIp=true"</span><span class="token keyword">fi</span>JAVA_MAJOR_VERSION<span class="token operator">=</span><span class="token punctuation">$(</span><span class="token variable">$JAVA</span> -version 2<span class="token operator">></span><span class="token operator">&amp;</span>1 <span class="token operator">|</span> <span class="token function">sed</span> -E -n <span class="token string">'s/.* version "([0-9]*).*$/\1/p'</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$JAVA_MAJOR_VERSION</span>"</span> -ge <span class="token string">"9"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>  JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Xlog:gc*:file=<span class="token variable">${BASE_DIR}</span>/logs/nacos_gc.log:time,tags:filecount=10,filesize=102400"</span><span class="token keyword">else</span>  JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Djava.ext.dirs=<span class="token variable">${JAVA_HOME}</span>/jre/lib/ext:<span class="token variable">${JAVA_HOME}</span>/lib/ext:<span class="token variable">${BASE_DIR}</span>/plugins/cmdb"</span>  JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Xloggc:<span class="token variable">${BASE_DIR}</span>/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M"</span><span class="token keyword">fi</span>JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -Dnacos.home=<span class="token variable">${BASE_DIR}</span>"</span>JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -jar <span class="token variable">${BASE_DIR}</span>/target/nacos-server.jar"</span>JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> <span class="token variable">${JAVA_OPT_EXT}</span>"</span>JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> --spring.config.location=<span class="token variable">${CUSTOM_SEARCH_LOCATIONS}</span>"</span>JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> --spring.config.name=<span class="token variable">${CUSTOM_SEARCH_NAMES}</span>"</span>JAVA_OPT<span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> --logging.config=<span class="token variable">${BASE_DIR}</span>/conf/nacos-logback.xml"</span><span class="token keyword">echo</span> <span class="token string">"nacos is starting,you can check the <span class="token variable">${BASE_DIR}</span>/logs/start.out"</span><span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$JAVA</span> <span class="token variable">${JAVA_OPT}</span>"</span> <span class="token operator">></span> <span class="token variable">${BASE_DIR}</span>/logs/start.out 2<span class="token operator">></span><span class="token operator">&amp;</span>1 <span class="token operator">&amp;</span><span class="token function">nohup</span> <span class="token variable">$JAVA</span> <span class="token variable">${JAVA_OPT}</span> <span class="token operator">></span> <span class="token variable">${BASE_DIR}</span>/logs/start.out 2<span class="token operator">></span><span class="token operator">&amp;</span>1 <span class="token operator">&lt;</span> /dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h2><blockquote><p><strong>docker build . –tag nacos:1.1.3</strong></p></blockquote><h2 id="启动脚本及配置"><a href="#启动脚本及配置" class="headerlink" title="启动脚本及配置"></a>启动脚本及配置</h2><blockquote><p>这里只贴出<strong>nacos-server-01.sh</strong>的内容</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span><span class="token function">sudo</span> <span class="token function">rm</span> -rf /data/nacos/cluster1/<span class="token punctuation">{</span>data,logs<span class="token punctuation">}</span>/*docker stop nacos-server-01docker <span class="token function">rm</span> nacos-server-01docker run --name nacos-server-01 --hostname nacos-server-01 -p 8848:8848 -p 9555:9555 -e NACOS_SERVERS<span class="token operator">=</span><span class="token string">"172.17.0.7:8848 172.17.0.8:8848"</span> -v /data/nacos/cluster1/conf/cluster.conf:/usr/local/nacos/conf/cluster.conf -v /data/nacos/cluster1/conf/application.properties:/usr/local/nacos/conf/application.properties -v /data/nacos/cluster1/logs:/usr/local/nacos/logs -v /data/nacos/cluster1/data:/usr/local/nacos/data -d nacos:1.1.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>/data/nacos/cluster1/conf/cluster.conf</strong>的内容：</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 这个就一个空文件，由于在上面的NACOS_SERVERS会传入，所以这里不用传入</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>/data/nacos/cluster1/conf/application.properties</strong>的内容：</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># spring</span><span class="token comment" spellcheck="true"># 注意这个地方不要修改，我修改成“/”然后那个集群节点一个都没有出来了</span>server.contextPath<span class="token operator">=</span>/nacos<span class="token comment" spellcheck="true"># 和上面一样</span>server.servlet.contextPath<span class="token operator">=</span>/nacosserver.port<span class="token operator">=</span>8848nacos.cmdb.dumpTaskInterval<span class="token operator">=</span>3600nacos.cmdb.eventTaskInterval<span class="token operator">=</span>10nacos.cmdb.labelTaskInterval<span class="token operator">=</span>300nacos.cmdb.loadDataAtStart<span class="token operator">=</span>false<span class="token comment" spellcheck="true"># metrics for prometheus</span><span class="token comment" spellcheck="true">#management.endpoints.web.exposure.include=*</span><span class="token comment" spellcheck="true"># metrics for elastic search</span>management.metrics.export.elastic.enabled<span class="token operator">=</span>false<span class="token comment" spellcheck="true">#management.metrics.export.elastic.host=http://localhost:9200</span><span class="token comment" spellcheck="true"># metrics for influx</span>management.metrics.export.influx.enabled<span class="token operator">=</span>false<span class="token comment" spellcheck="true">#management.metrics.export.influx.db=springboot</span><span class="token comment" spellcheck="true">#management.metrics.export.influx.uri=http://localhost:8086</span><span class="token comment" spellcheck="true">#management.metrics.export.influx.auto-create-db=true</span><span class="token comment" spellcheck="true">#management.metrics.export.influx.consistency=one</span><span class="token comment" spellcheck="true">#management.metrics.export.influx.compressed=true</span>server.tomcat.accesslog.enabled<span class="token operator">=</span>trueserver.tomcat.accesslog.pattern<span class="token operator">=</span>%h %l %u %t <span class="token string">"%r"</span> %s %b %D %<span class="token punctuation">{</span>User-Agent<span class="token punctuation">}</span>i<span class="token comment" spellcheck="true"># default current work dir</span>server.tomcat.basedir<span class="token operator">=</span><span class="token comment" spellcheck="true">## spring security config</span><span class="token comment" spellcheck="true">### turn off security</span><span class="token comment" spellcheck="true">#spring.security.enabled=false</span><span class="token comment" spellcheck="true">#management.security=false</span><span class="token comment" spellcheck="true">#security.basic.enabled=false</span><span class="token comment" spellcheck="true">#nacos.security.ignore.urls=/**</span>nacos.security.ignore.urls<span class="token operator">=</span>/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/v1/auth/login,/v1/console/health/**,/v1/cs/**,/v1/ns/**,/v1/cmdb/**,/actuator/**,/v1/console/server/**nacos.naming.distro.taskDispatchThreadCount<span class="token operator">=</span>1nacos.naming.distro.taskDispatchPeriod<span class="token operator">=</span>200nacos.naming.distro.batchSyncKeyCount<span class="token operator">=</span>1000nacos.naming.distro.initDataRatio<span class="token operator">=</span>0.9nacos.naming.distro.syncRetryDelay<span class="token operator">=</span>5000nacos.naming.data.warmup<span class="token operator">=</span>truenacos.naming.expireInstance<span class="token operator">=</span>truedb.num<span class="token operator">=</span>1db.url.0<span class="token operator">=</span>jdbc:mysql://<span class="token punctuation">{</span>mysql_server_address<span class="token punctuation">}</span>:<span class="token punctuation">{</span>mysql_server_port<span class="token punctuation">}</span>/nacos_config?characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span>connectTimeout<span class="token operator">=</span>1000<span class="token operator">&amp;</span>socketTimeout<span class="token operator">=</span>3000<span class="token operator">&amp;</span>autoReconnect<span class="token operator">=</span>truedb.user<span class="token operator">=</span><span class="token punctuation">{</span>mysql_user_name<span class="token punctuation">}</span>db.password<span class="token operator">=</span><span class="token punctuation">{</span>mysql_pass_word<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>到这里基本配置完成了</p></blockquote><h2 id="Nginx配置"><a href="#Nginx配置" class="headerlink" title="Nginx配置"></a>Nginx配置</h2><pre class="line-numbers language-nginx"><code class="language-nginx"><span class="token keyword">upstream</span> nacos<span class="token operator">-</span><span class="token keyword">server</span> <span class="token punctuation">{</span>  <span class="token keyword">server</span> <span class="token number">172.17</span><span class="token punctuation">.</span><span class="token number">0.7</span><span class="token punctuation">:</span><span class="token number">8848</span><span class="token punctuation">;</span>  <span class="token keyword">server</span> <span class="token number">172.17</span><span class="token punctuation">.</span><span class="token number">0.8</span><span class="token punctuation">:</span><span class="token number">8848</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">server</span> <span class="token punctuation">{</span>  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span> http2<span class="token punctuation">;</span>  <span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span>domain<span class="token punctuation">.</span>com<span class="token punctuation">.</span>crt<span class="token punctuation">;</span>  <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span>domain<span class="token punctuation">.</span>com<span class="token punctuation">.</span>key<span class="token punctuation">;</span>  <span class="token keyword">ssl_protocols</span> TLSv1 TLSv1<span class="token number">.1</span> TLSv1<span class="token number">.2</span><span class="token punctuation">;</span>  <span class="token keyword">ssl_ciphers</span> EECDH<span class="token operator">+</span>CHACHA20<span class="token punctuation">:</span>EECDH<span class="token operator">+</span>AES128<span class="token punctuation">:</span>RSA<span class="token operator">+</span>AES128<span class="token punctuation">:</span>EECDH<span class="token operator">+</span>AES256<span class="token punctuation">:</span>RSA<span class="token operator">+</span>AES256<span class="token punctuation">:</span>EECDH<span class="token operator">+</span>3DES<span class="token punctuation">:</span>RSA<span class="token operator">+</span>3DES<span class="token punctuation">:</span><span class="token operator">!</span>MD5<span class="token punctuation">;</span>  <span class="token keyword">ssl_prefer_server_ciphers</span> on<span class="token punctuation">;</span>  <span class="token keyword">ssl_session_timeout</span> 10m<span class="token punctuation">;</span>  <span class="token keyword">ssl_session_cache</span> builtin<span class="token punctuation">:</span><span class="token number">1000</span> shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span>10m<span class="token punctuation">;</span>  ssl_buffer_size <span class="token number">1400</span><span class="token punctuation">;</span>  <span class="token keyword">add_header</span> Strict<span class="token operator">-</span>Transport<span class="token operator">-</span>Security max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">15768000</span><span class="token punctuation">;</span>  ssl_stapling on<span class="token punctuation">;</span>  ssl_stapling_verify on<span class="token punctuation">;</span>  <span class="token keyword">server_name</span> domain<span class="token punctuation">.</span>com<span class="token punctuation">;</span>  <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm <span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$ssl_protocol</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">!=</span> domain<span class="token punctuation">.</span>com<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>domain<span class="token punctuation">.</span>com<span class="token variable">$request_uri</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">#location / {</span>  <span class="token comment" spellcheck="true">#  proxy_pass http://domain.com/nacos/;</span>  <span class="token comment" spellcheck="true">#}</span>  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>    <span class="token keyword">proxy_pass</span>  <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>nacos<span class="token operator">-</span><span class="token keyword">server</span><span class="token operator">/</span>nacos<span class="token operator">/</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_redirect</span>      off<span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>Proto <span class="token string">"http"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>不要直接使用，这里有使用到https的证书，所以需要判断修改。</p></blockquote><h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><blockquote><p>程序下载的软件在本地搭建一个Nginx服务即可</p></blockquote><blockquote><p>这个是<strong>nginx.sh</strong>的内容：</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#/bin/sh</span><span class="token comment" spellcheck="true"># 创建目录文件</span><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /data/nginx/<span class="token punctuation">{</span>conf,logs,sites,ssl,html<span class="token punctuation">}</span><span class="token function">sudo</span> <span class="token function">rm</span> -rf /data/nginx/logs/*<span class="token comment" spellcheck="true"># 停止nginx-server的容器</span>docker stop nginx-server<span class="token comment" spellcheck="true"># 删除nginx-server的容器</span>docker <span class="token function">rm</span> nginx-server<span class="token comment" spellcheck="true"># 启动nginx-server的容器，并映射目录</span>docker run --hostname nginx-server --name nginx-server -p 80:80 -p 443:443 -v /data/nginx/conf/nginx.conf:/etc/nginx/nginx.conf:ro -v /data/nginx/logs:/var/log/nginx -v /data/nginx/sites:/etc/nginx/conf.d -v /data/nginx/ssl:/etc/nginx/ssl -v /data/nginx/html:/usr/share/nginx/html:ro  -d nginx:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这个是<strong>/data/nginx/conf/nginx.conf</strong>的内容：</p></blockquote><pre class="line-numbers language-nginx"><code class="language-nginx"><span class="token keyword">user</span>  nginx<span class="token punctuation">;</span><span class="token keyword">worker_processes</span>  <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">error_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>error<span class="token punctuation">.</span>log warn<span class="token punctuation">;</span><span class="token keyword">pid</span>        <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>nginx<span class="token punctuation">.</span><span class="token keyword">pid</span><span class="token punctuation">;</span><span class="token keyword">events</span> <span class="token punctuation">{</span>    <span class="token keyword">worker_connections</span>  <span class="token number">1024</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">http</span> <span class="token punctuation">{</span>    <span class="token keyword">include</span>       <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>mime<span class="token punctuation">.</span><span class="token keyword">types</span><span class="token punctuation">;</span>    <span class="token keyword">default_type</span>  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>    <span class="token keyword">log_format</span>  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>                      <span class="token string">'$status $body_bytes_sent "$http_referer" '</span>                      <span class="token string">'"$http_user_agent" "$http_x_forwarded_for"'</span><span class="token punctuation">;</span>    <span class="token keyword">access_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>    <span class="token keyword">sendfile</span>        on<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">#tcp_nopush     on;</span>    <span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">#gzip  on;</span>    <span class="token keyword">include</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>conf<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这个是<strong>/data/nginx/sites/default.conf</strong>的内容：</p></blockquote><pre class="line-numbers language-nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">{</span>    <span class="token keyword">listen</span>    <span class="token number">80</span><span class="token punctuation">;</span>    <span class="token keyword">charset</span> utf8<span class="token punctuation">;</span>    <span class="token keyword">access_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>host<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>    <span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span>    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>        <span class="token keyword">root</span>   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>        <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>    <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token punctuation">{</span>        <span class="token keyword">root</span>   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>修改Nginx的配置之后我们要使修改的配置生效，直接使用<strong>docker exec -it nginx-server nginx -s reload</strong>在不重启容器的情况下让配置生效。<br>然后我们使用<strong>docker inspect nginx-server</strong>查看信息，获取IP。<br>将我们下载好的<strong>nacos-server-1.1.3.tar.gz</strong>放置到<strong>/data/nginx/html</strong>下，并修改相关的wget路径即可。这样就会让我们节约很多时间。不需要漫长的等待网络下载文件。</p></blockquote><h2 id="集群列表不显示"><a href="#集群列表不显示" class="headerlink" title="集群列表不显示"></a>集群列表不显示</h2><blockquote><p>在服务器上启动的时候发现不能正常展现集群节点，在线搜索一番发现需要配置一个<strong>nacos.server.ip=Local Ip</strong>这样的一个配置。<br>我们给启动脚本中添加一个配置<strong>NACOS_SERVER_IP=当前机器IP</strong></p></blockquote><hr><blockquote><p>自己搭建不能显示集群列表的原因：不能修改“<strong>server.contextPath=/nacos、server.servlet.contextPath=/nacos为server.contextPath=/、server.servlet.contextPath=/</strong>”</p></blockquote><h2 id="成品展示"><a href="#成品展示" class="headerlink" title="成品展示"></a>成品展示</h2><blockquote><p>目前配置完成的地址为：<a href="https://nacos.freegou.tech" target="_blank" rel="noopener">https://nacos.freegou.tech</a><br>账户名称：nacos<br>账户密码：nacos</p></blockquote><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">UPDATE</span> <span class="token punctuation">`</span>nacos_config<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'$2a$10$E/wOWsXoXMsOmAOf/aPcIuTJQc5VLumaU.46nOduWeQvyaAfUkhdC'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://blog.csdn.net/weixin_41465338/article/details/80106747" target="_blank" rel="noopener">Dockerfile常用指令详解</a></li><li><a href="https://www.cnblogs.com/linjiqin/p/8735230.html" target="_blank" rel="noopener">Dockerfile指令详解</a></li><li><a href="https://www.wandouip.com/t5i278697/" target="_blank" rel="noopener">关于使用Nacos集群遇到问题 – code:503 msg: server is STARTIN</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;软件环境&quot;&gt;&lt;a href=&quot;#软件环境&quot; class=&quot;headerlink&quot; title=&quot;软件环境&quot;&gt;&lt;/a&gt;软件环境&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;OS：Ubuntu Server 16.04.1 LTS 64位&lt;/li&gt;
&lt;li&gt;Docker：19.03.1&lt;/li&gt;
&lt;li&gt;Nacos Server：1.1.3&lt;ul&gt;
&lt;li&gt;nacos-sever-01：172.17.0.7 &lt;/li&gt;
&lt;li&gt;nacos-sever-02：172.17.0.8&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;文件目录：&lt;ul&gt;
&lt;li&gt;/data/nacos/{cluster1,cluster2}/{data,conf,logs}&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;学习目的&quot;&gt;&lt;a href=&quot;#学习目的&quot; class=&quot;headerlink&quot; title=&quot;学习目的&quot;&gt;&lt;/a&gt;学习目的&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;学会自己构建&lt;strong&gt;Nacos Server&lt;/strong&gt;，不依赖官方的&lt;strong&gt;nacos/nacos-server:last&lt;/strong&gt;镜像。&lt;br&gt;参考了很多别人构建的镜像&lt;a href=&quot;https://hub.docker.com/search?q=nacos&amp;type=image&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://hub.docker.com/search?q=nacos&amp;amp;type=image&lt;/a&gt;，发现别人写的都很简单。但是自己的始终不能像其他人一样简单的运行起来。&lt;br&gt;比如下面的例子：&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="docker" scheme="//kany.me/tags/docker/"/>
    
      <category term="dockerfile" scheme="//kany.me/tags/dockerfile/"/>
    
      <category term="nacos" scheme="//kany.me/tags/nacos/"/>
    
      <category term="nacos-server" scheme="//kany.me/tags/nacos-server/"/>
    
      <category term="注册中心" scheme="//kany.me/tags/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"/>
    
  </entry>
  
  <entry>
    <title>Docker使用MariaDB数据库</title>
    <link href="//kany.me/2019/09/12/docker-install-mariadb/"/>
    <id>//kany.me/2019/09/12/docker-install-mariadb/</id>
    <published>2019-09-12T07:38:40.000Z</published>
    <updated>2019-09-12T07:41:23.806Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><blockquote><p>上一篇文章在虚拟机上成功的安装了Docker容器，但是我有偷偷的重新弄了一个新的Docker版本。<br>环境详情如下：</p></blockquote><blockquote><ul><li>OS：Ubuntu Server 16.04.1 LTS 64位</li><li>Docker：19.03.1</li></ul></blockquote><h2 id="获取MariaDB镜像"><a href="#获取MariaDB镜像" class="headerlink" title="获取MariaDB镜像"></a>获取MariaDB镜像</h2><blockquote><p>在运行Docker容器的时候，如本地不存在指定镜像，会去<a href="https://hub.docker.com" target="_blank" rel="noopener">Docker的镜像站</a>去拉取镜像，所以我们可以不拉取。</p></blockquote><a id="more"></a><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 搜索镜像文件</span>docker search mariadb<span class="token comment" spellcheck="true"># 拉取镜像文件</span><span class="token comment" spellcheck="true"># docker pull mariadb:version</span>docker pull mariadb:last<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="创建运行命令"><a href="#创建运行命令" class="headerlink" title="创建运行命令"></a>创建运行命令</h2><blockquote><p>关于MariaDB镜像的详细信息可以在<a href="https://hub.docker.com/_/mariadb" target="_blank" rel="noopener">https://hub.docker.com/_/mariadb</a>中看到。这里直接上使用的命令</p></blockquote><p><code>MariaDB：</code></p><pre class="line-numbers language-bash"><code class="language-bash">docker run --name mariadb -p 3306:3306 -v /data/mariadb/conf:/etc/mysql/conf.d -v /data/mariadb/logs:/var/log/mysql -v /data/mariadb/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>数据库密码 -d mariadb:latest --character-set-server<span class="token operator">=</span>utf8mb4 --collation-server<span class="token operator">=</span>utf8mb4_unicode_ci<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>MySQL：</code></p><pre class="line-numbers language-bash"><code class="language-bash">docker run --name mysql -p 3306:3306 -v /data/mariadb/conf:/etc/mysql/conf.d -v /data/mariadb/logs:/var/log/mysql -v /data/mariadb/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>数据库密码 -d mysql:latest --character-set-server<span class="token operator">=</span>utf8mb4 --collation-server<span class="token operator">=</span>utf8mb4_unicode_ci<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>–name 指定运行容器名称，我这里定义的是 mariadb<br>-p 指定宿主机与容器间的端口映射<br>-v 数据卷，将宿主机的<code>/data/mariadb/data</code>映射到容器<code>/var/lib/mysql</code><br>-d 后台运行</p></blockquote><p>上面的参数根据镜像的不同而不同，具体有多少参数请查询上面的链接。-v /data/mariadb/conf:/etc/mysql/conf.d这个是官方给的配置，我进入容器中查看好像使用-v /data/mariadb/conf:/etc/mysql会好点。</p><h2 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h2><pre class="line-numbers language-bash"><code class="language-bash">docker <span class="token function">exec</span> mariadb sh -c <span class="token string">'exec mysqldump --all-databases -uroot -p"<span class="token variable">$MYSQL_ROOT_PASSWORD</span>"'</span> <span class="token operator">></span> /data/mariadb/all_databases.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="恢复数据库"><a href="#恢复数据库" class="headerlink" title="恢复数据库"></a>恢复数据库</h2><pre class="line-numbers language-bash"><code class="language-bash">docker <span class="token function">exec</span> -i some-mariadb sh -c <span class="token string">'exec mysql -uroot -p"<span class="token variable">$MYSQL_ROOT_PASSWORD</span>"'</span> <span class="token operator">&lt;</span> /data/mariadb/all_databases.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>备份和恢复如此的简单，感觉还是不错的。</p></blockquote><h2 id="进入正在运行的容器"><a href="#进入正在运行的容器" class="headerlink" title="进入正在运行的容器"></a>进入正在运行的容器</h2><blockquote><p>在参考资料里面有提到4种方式，但是我自己还是喜欢<strong>docker exec -it 容器ID /bin/bash</strong>，但是大家要查询容器信息还是建议使用<code>docker inspect 容器ID</code></p></blockquote><h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><blockquote><p>在网上看到一个保存windows 10系统激活Key的命令，懒得开单章了，直接弄个题外话</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash">wmic path softwarelicensingservice get OA3xOriginalProductKey<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://hub.docker.com" target="_blank" rel="noopener">Docker官方镜像站点</a></li><li><a href="https://www.cnblogs.com/bethal/p/5945015.html" target="_blank" rel="noopener">Docker常用命令</a></li><li><a href="https://www.runoob.com/docker/docker-command-manual.html" target="_blank" rel="noopener">Docker 命令大全</a></li><li><a href="https://www.cnblogs.com/cblogs/p/dockerCommand.html" target="_blank" rel="noopener">Docker常用命令汇总，和常用操作举例</a></li><li><a href="https://blog.csdn.net/u010820857/article/details/83784687" target="_blank" rel="noopener">进入正在运行的Docker容器的4种方式</a></li><li><a href="https://www.toutiao.com/a6724497689175654915" target="_blank" rel="noopener">备份序列号</a></li><li><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/repositories" target="_blank" rel="noopener">阿里云免费Docker镜像</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;背景介绍&quot;&gt;&lt;a href=&quot;#背景介绍&quot; class=&quot;headerlink&quot; title=&quot;背景介绍&quot;&gt;&lt;/a&gt;背景介绍&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;上一篇文章在虚拟机上成功的安装了Docker容器，但是我有偷偷的重新弄了一个新的Docker版本。&lt;br&gt;环境详情如下：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;OS：Ubuntu Server 16.04.1 LTS 64位&lt;/li&gt;
&lt;li&gt;Docker：19.03.1&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;获取MariaDB镜像&quot;&gt;&lt;a href=&quot;#获取MariaDB镜像&quot; class=&quot;headerlink&quot; title=&quot;获取MariaDB镜像&quot;&gt;&lt;/a&gt;获取MariaDB镜像&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;在运行Docker容器的时候，如本地不存在指定镜像，会去&lt;a href=&quot;https://hub.docker.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Docker的镜像站&lt;/a&gt;去拉取镜像，所以我们可以不拉取。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="docker" scheme="//kany.me/tags/docker/"/>
    
      <category term="dockerfile" scheme="//kany.me/tags/dockerfile/"/>
    
      <category term="database" scheme="//kany.me/tags/database/"/>
    
      <category term="mariadb" scheme="//kany.me/tags/mariadb/"/>
    
      <category term="mysql" scheme="//kany.me/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>在Ubuntu 16.04 安装 Docker</title>
    <link href="//kany.me/2019/09/11/docker-install/"/>
    <id>//kany.me/2019/09/11/docker-install/</id>
    <published>2019-09-11T10:09:06.000Z</published>
    <updated>2019-09-12T07:45:17.709Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用脚本自动安装-（仅适用于公网环境）"><a href="#使用脚本自动安装-（仅适用于公网环境）" class="headerlink" title="使用脚本自动安装 （仅适用于公网环境）"></a>使用脚本自动安装 （仅适用于公网环境）</h2><pre class="line-numbers language-bash"><code class="language-bash">curl -fsSL https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> -s docker --mirror Aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h2><blockquote><p>上面介绍了如何使用官方脚本自动安装Docker，下面使用手动当时来进行配置</p></blockquote><h3 id="修改镜像源"><a href="#修改镜像源" class="headerlink" title="修改镜像源"></a>修改镜像源</h3><blockquote><p>无论是使用何种系统，在国内想要速度快都要修改为国内的加速镜像</p></blockquote><a id="more"></a><p>Ubuntu 16.04（xenial ） 配置如下</p><pre class="line-numbers language-bash"><code class="language-bash">deb http://mirrors.aliyun.com/ubuntu/ xenial maindeb-src http://mirrors.aliyun.com/ubuntu/ xenial maindeb http://mirrors.aliyun.com/ubuntu/ xenial-updates maindeb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates maindeb http://mirrors.aliyun.com/ubuntu/ xenial universedeb-src http://mirrors.aliyun.com/ubuntu/ xenial universedeb http://mirrors.aliyun.com/ubuntu/ xenial-updates universedeb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates universedeb http://mirrors.aliyun.com/ubuntu/ xenial-security maindeb-src http://mirrors.aliyun.com/ubuntu/ xenial-security maindeb http://mirrors.aliyun.com/ubuntu/ xenial-security universedeb-src http://mirrors.aliyun.com/ubuntu/ xenial-security universe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>CentOS 7</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup<span class="token comment" spellcheck="true"># CentOS 7</span><span class="token function">wget</span> -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo<span class="token comment" spellcheck="true"># CentOS 6</span><span class="token function">wget</span> -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo<span class="token comment" spellcheck="true"># CentOS 5</span><span class="token function">wget</span> -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo<span class="token comment" spellcheck="true"># 清理缓存</span>yum makecache<span class="token comment" spellcheck="true"># 更新yum</span>yum -y update<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这里的配置可以打开参考资料的阿里云镜像站。</p></blockquote><h3 id="Ubuntu-配置"><a href="#Ubuntu-配置" class="headerlink" title="Ubuntu 配置"></a>Ubuntu 配置</h3><blockquote><p>实际上在下面的命令中已经有了添加源地址的操作</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># step 1: 安装必要的一些系统工具</span><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token function">sudo</span> <span class="token function">apt-get</span> -y <span class="token function">install</span> apt-transport-https ca-certificates curl software-properties-common<span class="token comment" spellcheck="true"># step 2: 安装GPG证书</span>curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key add -<span class="token comment" spellcheck="true"># Step 3: 写入软件源信息</span><span class="token function">sudo</span> add-apt-repository <span class="token string">"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable"</span><span class="token comment" spellcheck="true"># Step 4: 更新并安装 Docker-CE</span><span class="token function">sudo</span> <span class="token function">apt-get</span> -y update<span class="token function">sudo</span> <span class="token function">apt-get</span> -y <span class="token function">install</span> docker-ce注意：其他注意事项在下面的注释中<span class="token comment" spellcheck="true"># 安装指定版本的Docker-CE:</span><span class="token comment" spellcheck="true"># Step 1: 查找Docker-CE的版本:</span>apt-cache madison docker-ce<span class="token comment" spellcheck="true"># 执行后得到如下结果</span><span class="token comment" spellcheck="true"># docker-ce | 18.06.3~ce~3-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 18.06.2~ce~3-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 18.06.1~ce~3-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 18.06.0~ce~3-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 18.03.1~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 18.03.0~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.12.1~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.12.0~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.09.1~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.09.0~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.06.2~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.06.1~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.06.0~ce-0~ubuntu | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true">#docker-ce | 17.03.2~ce-0~ubuntu-trusty | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.03.1~ce-0~ubuntu-trusty | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># docker-ce | 17.03.0~ce-0~ubuntu-trusty | https://mirrors.aliyun.com/docker-ce/linux/ubuntu/ trusty/stable amd64 Packages</span><span class="token comment" spellcheck="true"># Step 2: 安装指定版本的Docker-CE: (VERSION 例如上面的 18.06.3~ce~3-0~ubuntu)</span><span class="token comment" spellcheck="true"># sudo apt-get -y install docker-ce=[VERSION]</span><span class="token function">sudo</span> <span class="token function">apt-get</span> -y <span class="token function">install</span> docker-ce<span class="token operator">=</span>18.06.3~ce~3-0~ubuntu<span class="token comment" spellcheck="true"># 通过经典网络、VPC网络内网安装时，用以下命令替换Step 2、Step 3中的命令</span><span class="token comment" spellcheck="true"># 经典网络：</span>curl -fsSL http://mirrors.aliyuncs.com/docker-ce/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key add -<span class="token function">sudo</span> add-apt-repository <span class="token string">"deb [arch=amd64] http://mirrors.aliyuncs.com/docker-ce/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable"</span><span class="token comment" spellcheck="true"># VPC网络：</span>curl -fsSL http://mirrors.cloud.aliyuncs.com/docker-ce/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key add -<span class="token function">sudo</span> add-apt-repository <span class="token string">"deb [arch=amd64] http://mirrors.cloud.aliyuncs.com/docker-ce/linux/ubuntu <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="CentOS-配置"><a href="#CentOS-配置" class="headerlink" title="CentOS 配置"></a>CentOS 配置</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># step 1: 安装必要的一些系统工具</span><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2<span class="token comment" spellcheck="true"># Step 2: 添加软件源信息</span><span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span class="token comment" spellcheck="true"># Step 3: 更新并安装 Docker-CE</span><span class="token function">sudo</span> yum makecache fast<span class="token function">sudo</span> yum -y <span class="token function">install</span> docker-ce<span class="token comment" spellcheck="true"># Step 4: 开启Docker服务</span><span class="token function">sudo</span> <span class="token function">service</span> docker start注意：其他注意事项在下面的注释中<span class="token comment" spellcheck="true"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，你可以通过以下方式开启。同理可以开启各种测试版本等。</span><span class="token comment" spellcheck="true"># vim /etc/yum.repos.d/docker-ce.repo</span><span class="token comment" spellcheck="true">#   将 [docker-ce-test] 下方的 enabled=0 修改为 enabled=1</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># 安装指定版本的Docker-CE:</span><span class="token comment" spellcheck="true"># Step 1: 查找Docker-CE的版本:</span><span class="token comment" spellcheck="true"># yum list docker-ce.x86_64 --showduplicates | sort -r</span><span class="token comment" spellcheck="true">#   Loading mirror speeds from cached hostfile</span><span class="token comment" spellcheck="true">#   Loaded plugins: branch, fastestmirror, langpacks</span><span class="token comment" spellcheck="true">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable</span><span class="token comment" spellcheck="true">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable</span><span class="token comment" spellcheck="true">#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable</span><span class="token comment" spellcheck="true">#   Available Packages</span><span class="token comment" spellcheck="true"># Step2 : 安装指定版本的Docker-CE: (VERSION 例如 18.06.3~ce~3-0~ubuntu)</span><span class="token comment" spellcheck="true"># sudo yum -y install docker-ce-[VERSION]</span><span class="token comment" spellcheck="true"># 注意：在某些版本之后，docker-ce安装出现了其他依赖包，如果安装失败的话请关注错误信息。例如 docker-ce 17.03 之后，需要先安装 docker-ce-selinux。</span><span class="token comment" spellcheck="true"># yum list docker-ce-selinux- --showduplicates | sort -r</span><span class="token comment" spellcheck="true"># sudo yum -y install docker-ce-selinux-[VERSION]</span><span class="token comment" spellcheck="true"># 通过经典网络、VPC网络内网安装时，用以下命令替换Step 2中的命令</span><span class="token comment" spellcheck="true"># 经典网络：</span><span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.aliyuncs.com/docker-ce/linux/centos/docker-ce.repo<span class="token comment" spellcheck="true"># VPC网络：</span><span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.could.aliyuncs.com/docker-ce/linux/centos/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这里是抄袭的，Ubuntu的验证了，CentOS的没有验证</p></blockquote><h2 id="配置用户"><a href="#配置用户" class="headerlink" title="配置用户"></a>配置用户</h2><blockquote><p>非root用户是不能直接使用<code>docker version</code>这个命令的，需要执行：<code>sudo usermod -aG docker %USER%</code><br>例如当前用户“ubuntu”，那么就是：<code>sudo usermod -aG docker ubuntu</code><br>然后退出登录，就可以正常执行了。</p></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># If you would like to use Docker as a non-root user, you should now consider</span><span class="token comment" spellcheck="true"># adding your user to the "docker" group with something like:</span><span class="token function">sudo</span> <span class="token function">usermod</span> -aG docker ubuntu<span class="token comment" spellcheck="true"># Remember that you will have to log out and back in for this to take effect!</span><span class="token comment" spellcheck="true"># WARNING: Adding a user to the "docker" group will grant the ability to run</span><span class="token comment" spellcheck="true">#         containers which can be used to obtain root privileges on the docker host.</span><span class="token comment" spellcheck="true">#         Refer to https://docs.docker.com/engine/security/security/#docker-daemon-attack-surface</span><span class="token comment" spellcheck="true">#         for more information.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>然后执行<strong>docker version</strong></p></blockquote><pre class="line-numbers language-bash"><code class="language-bash">Client: Version:           18.06.3-ce API version:       1.38 Go version:        go1.10.3 Git commit:        d7080c1 Built:             Wed Feb 20 02:27:13 2019 OS/Arch:           linux/amd64 Experimental:      <span class="token boolean">false</span>Server: Engine:  Version:          18.06.3-ce  API version:      1.38 <span class="token punctuation">(</span>minimum version 1.12<span class="token punctuation">)</span>  Go version:       go1.10.3  Git commit:       d7080c1  Built:            Wed Feb 20 02:25:38 2019  OS/Arch:          linux/amd64  Experimental:     <span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="添加加速镜像"><a href="#添加加速镜像" class="headerlink" title="添加加速镜像"></a>添加加速镜像</h2><blockquote><p>修改Docker镜像加速站点有下列方式：</p><ul><li>使用命令来配置加速站点</li></ul></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span>-<span class="token string">'EOF'</span><span class="token punctuation">{</span>    <span class="token string">"registry-mirrors"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;your accelerate address>"</span><span class="token punctuation">]</span>    <span class="token string">"insecure-registries"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token string">"其他的加速器"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><ul><li>使用脚本来配置加速站点（该脚本可以将 –registry-mirror 加入到你的 Docker 配置文件 /etc/docker/daemon.json 中。适用于 Ubuntu14.04、Debian、CentOS6 、CentOS7、Fedora、Arch Linux、openSUSE Leap 42.1，其他版本可能有细微不同。更多详情请访问文档。）</li></ul></blockquote><pre class="line-numbers language-bash"><code class="language-bash">curl -sSL https://raw.githubusercontent.com/wss434631143/xiaoshujiang/master/articles/Docker/shell/set_mirror.sh <span class="token operator">|</span> sh -s <span class="token operator">&lt;</span>your accelerate address<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><ul><li>通过修改启动脚本配置加速站点(这个是修改启动脚本，每个启动脚本的位置可能不同，需要注意)</li></ul></blockquote><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">vi</span> /lib/systemd/system/docker.serviceExecStart<span class="token operator">=</span>/usr/bin/dockerd --registry-mirror<span class="token operator">=</span><span class="token operator">&lt;</span>your accelerate address<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://opsx.alibaba.com/mirror" target="_blank" rel="noopener">阿里云镜像站</a></li><li><a href="https://docs.docker.com/install/" target="_blank" rel="noopener">Docker Guides</a></li><li><a href="https://www.jianshu.com/p/d838b04a0d2f" target="_blank" rel="noopener">修改Linux软件源</a></li><li><a href="https://yq.aliyun.com/articles/29941" target="_blank" rel="noopener">Docker 镜像加速器</a></li><li><a href="https://yq.aliyun.com/articles/110806" target="_blank" rel="noopener">Docker CE 镜像源站</a></li><li><a href="https://www.cnblogs.com/wushuaishuai/p/9984228.html" target="_blank" rel="noopener">Docker 国内仓库和镜像</a></li><li><a href="https://blog.csdn.net/nklinsirui/article/details/80490537" target="_blank" rel="noopener">Docker国内Yum源和国内镜像仓库</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;使用脚本自动安装-（仅适用于公网环境）&quot;&gt;&lt;a href=&quot;#使用脚本自动安装-（仅适用于公网环境）&quot; class=&quot;headerlink&quot; title=&quot;使用脚本自动安装 （仅适用于公网环境）&quot;&gt;&lt;/a&gt;使用脚本自动安装 （仅适用于公网环境）&lt;/h2&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;手动安装&quot;&gt;&lt;a href=&quot;#手动安装&quot; class=&quot;headerlink&quot; title=&quot;手动安装&quot;&gt;&lt;/a&gt;手动安装&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;上面介绍了如何使用官方脚本自动安装Docker，下面使用手动当时来进行配置&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;修改镜像源&quot;&gt;&lt;a href=&quot;#修改镜像源&quot; class=&quot;headerlink&quot; title=&quot;修改镜像源&quot;&gt;&lt;/a&gt;修改镜像源&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;无论是使用何种系统，在国内想要速度快都要修改为国内的加速镜像&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
      <category term="docker" scheme="//kany.me/tags/docker/"/>
    
      <category term="dockerfile" scheme="//kany.me/tags/dockerfile/"/>
    
      <category term="database" scheme="//kany.me/tags/database/"/>
    
      <category term="mariadb" scheme="//kany.me/tags/mariadb/"/>
    
      <category term="mysql" scheme="//kany.me/tags/mysql/"/>
    
  </entry>
  
</feed>
